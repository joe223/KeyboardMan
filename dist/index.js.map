{"version":3,"file":null,"sources":["../src.js"],"sourcesContent":["export default class KeyboardMan {\n    constructor (config = {}) {\n        const {\n            timeout\n        } = config\n        this.timeout = timeout || 1200\n        this.init()\n    }\n\n    parser (scheme) {\n        const reg = /\\((.*?)\\)/\n        const rule = scheme.split('+').map(step => {\n            return step.split('&').map(item => {\n                let group = item.match(reg)\n                group = group ? group[1] : group\n                return {\n                    key: (group ? group : item).split('|')\n                }\n            })\n        })\n        return rule\n    }\n\n    exec (scheme, cb) {\n        let steps = this.steps.slice(-scheme.length)\n        let match = true\n        for (let groupIndex = 0; groupIndex < scheme.length; groupIndex++) {\n            if (!match) break\n            for (let stepIndex = 0; stepIndex < scheme[groupIndex].length; stepIndex++) {\n                if (!steps[groupIndex] || !steps[groupIndex][stepIndex]) {\n                    match = false\n                    break\n                }\n                const key = steps[groupIndex][stepIndex]\n                const keys = scheme[groupIndex][stepIndex].key\n                if (!scheme[groupIndex][stepIndex].key.includes(key)) {\n                    match = false\n                    break\n                }\n            }\n        }\n        if (match) cb()\n    }\n\n    flush () {\n        clearTimeout(this.timeoutId)\n        this.timeoutId = setTimeout(() => {\n            this.init()\n        }, this.timeout)\n    }\n\n    init () {\n        this.steps = []\n        this.step = []\n        this.count = 0\n        this.last = null\n        this.steps.push(this.step)\n    }\n\n    on (str, cb) {\n        const scheme = this.parser(str)\n        document.addEventListener('keydown', e => {\n            let { step, last } = this\n            const keyCode = e.keyCode\n            if (keyCode !== last) {\n                this.last = e.keyCode\n                this.count++\n                step.push(e.key)\n                this.exec(scheme, cb)\n            }\n        })\n        document.addEventListener('keyup', e => {\n            let { steps } = this\n            this.count--\n            if (this.count < 1) {\n                steps.push(this.step = [])\n                this.flush()\n            }\n            this.last = null\n        })\n        return scheme\n    }\n}\nfunction clone (ob) {\n    return JSON.parse(JSON.stringify(ob))\n}"],"names":["KeyboardMan","config","timeout","init","scheme","reg","rule","split","map","step","group","item","match","cb","steps","slice","length","groupIndex","stepIndex","key","keys","includes","timeoutId","setTimeout","count","last","push","str","parser","addEventListener","keyCode","e","exec","flush"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAqBA;2BACS;YAAbC,MAAa,uEAAJ,EAAI;;YAElBC,OAFkB,GAGlBD,MAHkB,CAElBC,OAFkB;;aAIjBA,OAAL,GAAeA,WAAW,IAA1B;aACKC,IAAL;;;;;+BAGIC,QAAQ;gBACNC,MAAM,WAAZ;gBACMC,OAAOF,OAAOG,KAAP,CAAa,GAAb,EAAkBC,GAAlB,CAAsB,gBAAQ;uBAChCC,KAAKF,KAAL,CAAW,GAAX,EAAgBC,GAAhB,CAAoB,gBAAQ;wBAC3BE,QAAQC,KAAKC,KAAL,CAAWP,GAAX,CAAZ;4BACQK,QAAQA,MAAM,CAAN,CAAR,GAAmBA,KAA3B;2BACO;6BACE,CAACA,QAAQA,KAAR,GAAgBC,IAAjB,EAAuBJ,KAAvB,CAA6B,GAA7B;qBADT;iBAHG,CAAP;aADS,CAAb;mBASOD,IAAP;;;;6BAGEF,QAAQS,IAAI;gBACVC,QAAQ,KAAKA,KAAL,CAAWC,KAAX,CAAiB,CAACX,OAAOY,MAAzB,CAAZ;gBACIJ,QAAQ,IAAZ;iBACK,IAAIK,aAAa,CAAtB,EAAyBA,aAAab,OAAOY,MAA7C,EAAqDC,YAArD,EAAmE;oBAC3D,CAACL,KAAL,EAAY;qBACP,IAAIM,YAAY,CAArB,EAAwBA,YAAYd,OAAOa,UAAP,EAAmBD,MAAvD,EAA+DE,WAA/D,EAA4E;wBACpE,CAACJ,MAAMG,UAAN,CAAD,IAAsB,CAACH,MAAMG,UAAN,EAAkBC,SAAlB,CAA3B,EAAyD;gCAC7C,KAAR;;;wBAGEC,MAAML,MAAMG,UAAN,EAAkBC,SAAlB,CAAZ;wBACME,OAAOhB,OAAOa,UAAP,EAAmBC,SAAnB,EAA8BC,GAA3C;wBACI,CAACf,OAAOa,UAAP,EAAmBC,SAAnB,EAA8BC,GAA9B,CAAkCE,QAAlC,CAA2CF,GAA3C,CAAL,EAAsD;gCAC1C,KAAR;;;;;gBAKRP,KAAJ,EAAWC;;;;gCAGN;;;yBACQ,KAAKS,SAAlB;iBACKA,SAAL,GAAiBC,WAAW,YAAM;sBACzBpB,IAAL;aADa,EAEd,KAAKD,OAFS,CAAjB;;;;+BAKI;iBACCY,KAAL,GAAa,EAAb;iBACKL,IAAL,GAAY,EAAZ;iBACKe,KAAL,GAAa,CAAb;iBACKC,IAAL,GAAY,IAAZ;iBACKX,KAAL,CAAWY,IAAX,CAAgB,KAAKjB,IAArB;;;;2BAGAkB,KAAKd,IAAI;;;gBACHT,SAAS,KAAKwB,MAAL,CAAYD,GAAZ,CAAf;qBACSE,gBAAT,CAA0B,SAA1B,EAAqC,aAAK;oBAChCpB,IADgC,UAChCA,IADgC;oBAC1BgB,IAD0B,UAC1BA,IAD0B;;oBAEhCK,UAAUC,EAAED,OAAlB;oBACIA,YAAYL,IAAhB,EAAsB;2BACbA,IAAL,GAAYM,EAAED,OAAd;2BACKN,KAAL;yBACKE,IAAL,CAAUK,EAAEZ,GAAZ;2BACKa,IAAL,CAAU5B,MAAV,EAAkBS,EAAlB;;aAPR;qBAUSgB,gBAAT,CAA0B,OAA1B,EAAmC,aAAK;oBAC9Bf,KAD8B,UAC9BA,KAD8B;;uBAE/BU,KAAL;oBACI,OAAKA,KAAL,GAAa,CAAjB,EAAoB;0BACVE,IAAN,CAAW,OAAKjB,IAAL,GAAY,EAAvB;2BACKwB,KAAL;;uBAECR,IAAL,GAAY,IAAZ;aAPJ;mBASOrB,MAAP;;;;IAGR;;;;"}